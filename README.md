CCMS（客舱服务）平台服务端
=================================================

说明
-------------------------------------------------
这个服务端是专门为CCMS（客舱服务）使用的后台系统。是对原来1.0版本的升级，并增加了Web服务的部分。未来，需要考虑增加基于Web的服务和管理功能。  
主要使用到``Node.Js``的如下组件:  

> * **express**：对外提供HTTP服务。  
> * **http**：对外提供HTTP服务。  
> * **socket.io**：提供Websocket服务。  
> * **net**：提供TCP服务链接。  
> * **optimist**：对参数进行处理。  
> * **mongodb**：数据的存储（v2.0以上）。  
> * **redis**：数据的存储（v2.0以上）。

**最后修改时间**：2016年10月29日

1. v2.0  
可以进行更多的web操作。
2. v1.0  
可以访问web网站，能知道当前tcp连接和websocket的连接数量。


##<font color="#ff0000">安装说明</font>
1. 必须先安装node.js。具体请参考相关的 **nodejs** 安装说明。
2. 在命令行下，输入：
  `npm install`
3. 在命令行下，运行
  `node ccms.js --tsport=8080 --wsport=2000`
 *说明：没有带参数的话，系统会给出相应的提示。*


##服务说明
###express服务
Express 是一个简洁而灵活的 node.js Web应用框架, 可以在此基础上创建web应用。


###socket.io服务
提供websocket服务，打开的端口为wsport。
控制命令是\@开头的Jason格式字符串，需要转发给链接到tcp端口的客户端。如果控制命令没有\@字符，则认为是内部命令不需要转发。


###net服务
提供TCP服务，打开的端口为tsport。    
控制命令是\#开头的Jason格式字符串，需要转发到连接到websocket上的客户端。如果控制命令没有\#字符，则认为是内部命令不需要转发。  
客户端连接上tcp端口后，需要马上发idXXXXX，以表明自己的身份。注意：此身份不要和其他连接相同，否则会造成消息收不到。

###mongodb
存储配置数据

###optimist
有三个参数，其中两个是必须的

* --tsport(必须):tcp端口号
* --wsport(必须)：websocket和Web服务的端口号
* --monitor(可选)：y/n，表示需要监控进程是否运行

##功能说明

1. 实现websocket和tcp socket之间连接客户端的消息转发。
2. 定时向连接的tcp客户端发消息，询问当前的运行状态。
3. 监控tcp客户端的进程是否存在，如果不存在，则立即启动该进程。
4. 提供http服务，可以查看当前的用户连接数。
5. 支持cors访问。